<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>分类: php代码审计 - WebDog</title><meta property="og:type" content="blog"><meta property="og:title" content="WebDog"><meta property="og:url" content="http://yoursite.com/"><meta property="og:site_name" content="WebDog"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://yoursite.com/img/og_image.png"><meta property="article:author" content="WebDog"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://yoursite.com"},"headline":"WebDog","image":["http://yoursite.com/img/og_image.png"],"author":{"@type":"Person","name":"WebDog"},"description":""}</script><link rel="alternative" href="/atom.xml" title="WebDog" type="application/atom+xml"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="WebDog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/webysx"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/categories">分类</a></li><li class="is-active"><a href="#" aria-current="page">php代码审计</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-02-04T08:05:40.000Z" title="2020-02-04T08:05:40.000Z">2020-02-04</time><span class="level-item"><a class="link-muted" href="/categories/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">php代码审计</a></span><span class="level-item">18 分钟 读完 (大约 2745 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/00%E6%88%AA%E6%96%AD/">00截断</a></h1><div class="content"><h1 id="00截断——文件上传"><a href="#00截断——文件上传" class="headerlink" title="00截断——文件上传"></a>00截断——文件上传</h1><p><strong>原理分析：</strong></p>
<blockquote>
<p>0x00是十六进制数，表示ASCII码为0的字符，也是字符串的结束标识符。攻击者可以利用手动添加结束标识符（0x00或%00）来截断上传的内容，从而绕过客户端或服务器的检测，上传非法文件。</p>
</blockquote>
<p><strong>条件：</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1<span class="selector-class">.php</span>版本小于5<span class="selector-class">.3</span><span class="selector-class">.4</span>；</span><br><span class="line">2<span class="selector-class">.php</span><span class="selector-class">.ini</span>文件中的<span class="selector-tag">magic_quotes_gpc</span>设置为<span class="selector-tag">off</span>。</span><br></pre></td></tr></table></figure>

<p><img src="/00%E6%88%AA%E6%96%AD/12.png" alt="12"></p>
<p><strong>注：</strong></p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">一般将<span class="number">00</span>截断分为<span class="number">0x00</span>截断和%<span class="number">00</span>截断两种，实际上两种截断的本质是一样的，%<span class="number">00</span>经过url解码后就变成<span class="number">0x00</span>。所以说%<span class="number">00</span>适合于<span class="keyword">get</span>方法，可直接在添加在url中，经过url解码后就变成<span class="number">0x00</span>；<span class="number">0x00</span>适合于post方法，可通过直接修改文件的二进制文件，添加<span class="number">00</span>即可，因为二进制<span class="number">00</span>与十六进制<span class="number">0x00</span>都表示<span class="number">0</span>。</span><br></pre></td></tr></table></figure>



<h2 id="一、-00截断-upload-labs-master-Pass-12"><a href="#一、-00截断-upload-labs-master-Pass-12" class="headerlink" title="一、%00截断(upload-labs-master/Pass-12)"></a>一、%00截断(upload-labs-master/Pass-12)</h2><blockquote>
<p>%00截断一般是在url中直接使用%00截断，%00在被浏览器进行urldecode操作后变成0x00，最终传入PHP函数执行截断操作。</p>
</blockquote>
<p><strong>源码分析：</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $ext_arr = <span class="keyword">array</span>(<span class="string">'jpg'</span>,<span class="string">'png'</span>,<span class="string">'gif'</span>); <span class="comment">//创建白名单</span></span><br><span class="line">    $file_ext = substr($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>],strrpos($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>],<span class="string">"."</span>)+<span class="number">1</span>); <span class="comment">//截取后缀</span></span><br><span class="line">    <span class="keyword">if</span>(in_array($file_ext,$ext_arr))&#123; <span class="comment">//检查后缀</span></span><br><span class="line">        $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>]; <span class="comment">//获得临时文件名</span></span><br><span class="line">        $img_path = $_GET[<span class="string">'save_path'</span>].<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_ext; <span class="comment">//使用随机数改写文件名和文件路径进行防御</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123; <span class="comment">//将文件存入设定的路径</span></span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        $msg = <span class="string">"只允许上传.jpg|.png|.gif类型文件！"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先PHP代码接收到上传的表单信息，然后截取文件后缀，并进行白名单检查，最后将上传的文件存入服务器。这里导致00截断的原因是<code>$img_path = $_GET[&#39;save_path&#39;].&quot;/&quot;.rand(10, 99).date(&quot;YmdHis&quot;).&quot;.&quot;.$file_ext;</code>这行代码没有对<code>save_path</code>进行检测，直接拼接到路径中，导致可以直接修改变量<code>save_path</code>的值，进而利用00截断绕过使用随机数改写文件名和文件路径的防御。</p>
<p><strong>漏洞复现：</strong></p>
<ol>
<li>正常上传，查看上传后的路径，发现是直接拼接<code>save_path</code>；</li>
</ol>
   <img src="/00%E6%88%AA%E6%96%AD/2.png" alt="2" style="zoom:150%;">

   <img src="/00%E6%88%AA%E6%96%AD/1.png" alt="1" style="zoom:150%;">

<ol start="2">
<li><p>修改<code>save_path</code>，利用%00截断绕过，上传webshell木马文件；</p>
<p><img src="/00%E6%88%AA%E6%96%AD/3.png" alt="3"></p>
<p><img src="/00%E6%88%AA%E6%96%AD/4.png" alt="4"></p>
</li>
</ol>
<h2 id="二、0x00截断-upload-labs-master-Pass-13"><a href="#二、0x00截断-upload-labs-master-Pass-13" class="headerlink" title="二、0x00截断(upload-labs-master/Pass-13)"></a>二、0x00截断(upload-labs-master/Pass-13)</h2><blockquote>
<p>0x00截断一般是修改post的二进制文件，将对应字符的十六进制（或二进制）编码改为00，从而起到截断的作用。</p>
</blockquote>
<p><strong>源码分析：</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $ext_arr = <span class="keyword">array</span>(<span class="string">'jpg'</span>,<span class="string">'png'</span>,<span class="string">'gif'</span>);</span><br><span class="line">    $file_ext = substr($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>],strrpos($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>],<span class="string">"."</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(in_array($file_ext,$ext_arr))&#123;</span><br><span class="line">        $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">        $img_path = $_POST[<span class="string">'save_path'</span>].<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_ext;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">"上传失败"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = <span class="string">"只允许上传.jpg|.png|.gif类型文件！"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里除了使用post方式上传变量<code>save_path</code>外，其他的基本与一中的相同。漏洞产生的原因还是直接拼接文件路径。</p>
<p><strong>漏洞复现：</strong></p>
<ol>
<li><p>正常上传，查看上传后的路径，发现是直接拼接<code>save_path</code>；</p>
<img src="/00%E6%88%AA%E6%96%AD/6.png" alt="6" style="zoom:150%;">

<img src="/00%E6%88%AA%E6%96%AD/5.png" alt="5" style="zoom:150%;">
</li>
<li><p>这里要注意变量<code>save_path</code>是post方式，所以要修改post文件的十六进制文件的内容。这里不能直接在post文件的<code>../upload/</code>后面直接加<code>webshell.php00</code>，因为此时的0是一个字符，有对应的十六进制编码<code>0x30</code>，可见输入00最后传入服务器的内容为<code>0x30</code>，而不是<code>0x00</code>，所以不能起到截断作用，必须要在十六进制文件中修改；首先在<code>../upload/</code>后面添加<code>webshell.php</code>(注意最后面有一个空格)，空格的十六进制编码为0x20；</p>
<p><img src="/00%E6%88%AA%E6%96%AD/7.png" alt="7"></p>
<p>打开十六进制文件，修改空格位置对应的十六进制编码为00；</p>
<p><img src="/00%E6%88%AA%E6%96%AD/8.png" alt="8"></p>
</li>
</ol>
<p>   <img src="/00%E6%88%AA%E6%96%AD/9.png" alt="9"></p>
<p>   <img src="/00%E6%88%AA%E6%96%AD/10.png" alt="10"></p>
<ol start="3">
<li><p>修改好后直接<code>Forward</code>，上传文件。</p>
<p><img src="/00%E6%88%AA%E6%96%AD/11.png" alt="11"></p>
</li>
</ol>
<p><strong>思考：</strong></p>
<p>在<code>$img_path = $_GET[&#39;save_path&#39;].&quot;/&quot;.rand(10, 99).date(&quot;YmdHis&quot;).&quot;.&quot;.$file_ext;</code>和<code>$img_path = $_POST[&#39;save_path&#39;].&quot;/&quot;.rand(10, 99).date(&quot;YmdHis&quot;).&quot;.&quot;.$file_ext;</code>这两行代码中，都在<code>save_path</code>后面加一个<code>&quot;/&quot;</code>，这里我还不是很清楚反斜杠的作用。但当直接在<code>../upload/</code>后面直接添加<code>webshell.php</code>而没有进行截断时，就会发生上传错误，此时路径会变成<code>../upload/webshell.php/···</code>，上传过程中找不到路径从而导致错误发生。我觉得这也可以作为一种防御方法，在修改的内容的后面（%00之前）加上一个反斜杠，导致文件路径丢失，发生错误，无法上传非法文件，而且浏览器对url中的多个反斜杠会忽略。</p>
<h2 id="三、深入理解00截断"><a href="#三、深入理解00截断" class="headerlink" title="三、深入理解00截断"></a>三、深入理解00截断</h2><p>0x00和%00最后都会被解析为<code>chr(0)</code>，<code>chr()</code>是一个函数，参数是ASCII码，返回值为参数的ASCII码对应的字符。<code>chr(0)</code>的返回值为NULL，即空字符。截断的关键就在于空字符NULL，如果一个字符串中存在空字符，在被php解析的时候会导致空字符后面的字符串被丢弃。这种情况会出现在php(版本&lt;5.3.4)中，这也就解释了为什么00截断的条件要求php版本小于5.3.4。</p>
<table>
<thead>
<tr>
<th>ASCII字符</th>
<th>描述</th>
<th>URL编码</th>
<th>十六进制代码</th>
</tr>
</thead>
<tbody><tr>
<td>NUL</td>
<td>null字符，空字符</td>
<td>%00</td>
<td>00</td>
</tr>
</tbody></table>
<h2 id="四、再探-00"><a href="#四、再探-00" class="headerlink" title="四、再探%00"></a>四、再探%00</h2><p><strong>注意：</strong>在使用%00进行截断时，不能直接将%00加在文件名中。因为PHP函数会对文件的后缀进行提取，然后再进行检测。如果文件名是<code>webshell.php%00webshell.jpg</code>，那么截取后缀的函数就会在%00处停止，所以后缀就为<code>.php</code>，而不是<code>.jpg</code>，从而导致文件不能上传。%00使用的场景还要视具体的情况而定。上面举的例子是由于后端php源码中没有检查<code>$_GET[&#39;save_path&#39;]</code>，所以可以修改<code>save_path</code>的内容，使用%00绕过。</p>
<p><strong>%00是否需要进行urldecode操作？</strong></p>
<p>其实使用%00必须要进行url解码。</p>
<p>在使用post方法上传文件（要与post传参区分开）时，需要创建一个表单来支持文件上传，也就是使用表单来实现文件上传。表单内容：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- The data encoding type, enctype, MUST be specified as below --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span> <span class="attr">action</span>=<span class="string">"__URL__"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- MAX_FILE_SIZE must precede the file input field --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"MAX_FILE_SIZE"</span> <span class="attr">value</span>=<span class="string">"30000"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Name of input element determines name in $_FILES array --&gt;</span></span><br><span class="line">    Send this file: <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"userfile"</span> <span class="attr">type</span>=<span class="string">"file"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Send File"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>#表单中的_<em>URL_</em> 应该被换掉，指向一个真实的 PHP 文件。</p>
<p><code>enctype=&quot;multipart/form-data&quot;</code>：<code>enctype</code>，即<code>encodetype</code>，是编码类型的意思；<code>multipart/form-data</code>是指表单数据由多部分构成，既有文本数据，又有文件等二进制数据。默认情况下，<code>enctype</code>的值是<code>application/x-www-form-urlencoded</code>，不能用于文件上传，只有当值设定为<code>multipart/form-data</code>，才能完整的传递文件数据。<code>application/x-www-form-urlencoded</code>不是不能上传文件，而是只能上传文本格式的文件，上传其他类型的文件时可能会导致文件损坏，数据丢失等等；<code>multipart/form-data</code>是将文件以二进制的形式上传，从而可以实现多种类型的文件上传。表单如果支持上传文件，则还必须附加二进制数据并将其与表单数据分开。 </p>
<p>当设置<code>enctype=&quot;multipart/form-data&quot;</code>时，表示请求主体内容不做url编码，直接原文传输。在一中，参数附在url中，所以要使用%00（即ASCII字符中的NULL字符的url编码）来进行阶段，因为浏览器此时不会进行url编码，数据传到服务器后，服务器会对url进行解码，然后再将解码后的内容传入php文件。所以php接收到的是0x00（NULL），而不是%00。要注意的是，浏览器只会在必要的时候进行URL编码，不会进行URL解码，所有的url都是在服务器上进行urldecode操作的。而在二中，情况就会有所不同。</p>
<p>二中post传递的参数<code>save_path</code>是放在HTTP请求主体内容中，不像一中是放在url中，所以服务器不会对其进行url解码，也就是说不能直接使用%00来截断，只能在对应的十六进制文件中修改。如果直接在根目录<code>../upload/</code>后面加NUL，不能起到截断作用，因为NUL会被当成三个字符，而不是单个字符，所以必须要修改十六进制代码才行。如果要在二中使用%00，就需要先进行url解码才可以起到截断作用。</p>
<p><strong>在二中使用%00截断：</strong></p>
<ol>
<li><p>burpsuite的Decoder模块提供了解码功能。首先使用bp抓包，修改变量<code>save_path</code>的值，然后右键，Send to Decoder;</p>
<p><img src="/00%E6%88%AA%E6%96%AD/13.png" alt="13"></p>
</li>
<li><p>然后进入Decode模块，选择解码方式为URL，进行解码；</p>
<p><img src="/00%E6%88%AA%E6%96%AD/14.png" alt="14"></p>
</li>
<li><p>将解码后的内容复制到Proxy模块中，然后Forward；</p>
<p><img src="/00%E6%88%AA%E6%96%AD/15.png" alt="15"></p>
<p><img src="/00%E6%88%AA%E6%96%AD/16.png" alt="16"></p>
</li>
<li><p>上传成功。</p>
<img src="/00%E6%88%AA%E6%96%AD/17.png" alt="17" style="zoom:150%;">



</li>
</ol>
<h1 id="00截断——代码审计"><a href="#00截断——代码审计" class="headerlink" title="00截断——代码审计"></a>00截断——代码审计</h1><p><strong>原理分析：</strong></p>
<blockquote>
<p>一些PHP函数在读取到0x00（指ASCII码为0 的字符，空字符）时，会自动停止，空字符后面的内容会被忽略。所以可以使用00截断来绕过函数的检测，进行非法操作。</p>
</blockquote>
<p><strong>实例（bugku-ereg正则%00截断）：</strong></p>
<p><a href="https://ctf.bugku.com/challenges#ereg%E6%AD%A3%E5%88%99%00%E6%88%AA%E6%96%AD"> https://ctf.bugku.com/challenges#ereg正则截断 </a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//题目源码</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$flag = <span class="string">"xxx"</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span> ($_GET[<span class="string">'password'</span>]))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (ereg (<span class="string">"^[a-zA-Z0-9]+$"</span>, $_GET[<span class="string">'password'</span>]) === <span class="keyword">FALSE</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">You password must be alphanumeric</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (strlen($_GET[<span class="string">'password'</span>]) &lt; <span class="number">8</span> &amp;&amp; $_GET[<span class="string">'password'</span>] &gt; <span class="number">9999999</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (strpos ($_GET[<span class="string">'password'</span>], <span class="string">'*-*'</span>) !== <span class="keyword">FALSE</span>) <span class="comment">//strpos — 查找字符串首次出现的位置</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">'Flag: '</span> . $flag);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">'</span></span><br><span class="line"><span class="string">*-* have not been found</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'</span></span><br><span class="line"><span class="string">Invalid password</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>分析：</strong></p>
<p><code>ereg</code>正则限制了<code>password</code>的值只能为一个或多个大小写字母，数字；</p>
<p><code>password</code>的长度要小于8，而且要大于9999999；</p>
<p><code>strpos</code>查找并返回一个字符串在另一个字符串中出现的位置（区分大小写），<code>password</code>中必须要出现<code>*-*</code>才能getflag；</p>
<p><strong>绕过：</strong></p>
<p>利用00截断绕过<code>ereg</code>正则，并添加<code>&#39;-&#39;</code>；</p>
<p>利用科学计数法绕过长度限制；</p>
<p><strong>payload:</strong></p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//123.206.87.240:9009/5.php?password=1e8%00*-*</span></span><br></pre></td></tr></table></figure>

<img src="/00%E6%88%AA%E6%96%AD/18.png" alt="18">

<p><strong>注：%00的长度为1</strong></p>
<p>%00经过url解码后，其十六进制代码为00，变成二进制就是00000000，占八位（一字节），所以长度为1。</p>
</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="" src="/img/avatar.png" alt="WebDog"></figure><p class="title is-size-4 is-block line-height-inherit">WebDog</p><p class="is-size-6 is-block">莫得感情的Web渗透测试机器</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>ChengDu</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">23</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">4</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">4</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/webysx" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/webysx"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"><span class="level-start"><span class="level-item">php代码审计</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/python%E7%88%AC%E8%99%AB/"><span class="level-start"><span class="level-item">python爬虫</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/sql%E6%B3%A8%E5%85%A5/"><span class="level-start"><span class="level-item">sql注入</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"><span class="level-start"><span class="level-item">文件上传</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"><span class="tag">php代码审计</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python%E7%88%AC%E8%99%AB/"><span class="tag">python爬虫</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sql%E6%B3%A8%E5%85%A5/"><span class="tag">sql注入</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"><span class="tag">文件上传</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2020-03-30T12:42:14.000Z">2020-03-30</time></p><p class="title is-6"><a class="link-muted" href="/kali%E5%AE%89%E8%A3%85/">kali安装</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-03-28T01:58:28.000Z">2020-03-28</time></p><p class="title is-6"><a class="link-muted" href="/%E9%AA%8C%E8%AF%81%E7%A0%81%E5%AE%89%E5%85%A8/">验证码安全</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-03-25T11:07:25.000Z">2020-03-25</time></p><p class="title is-6"><a class="link-muted" href="/ctf/">ctf</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-03-25T10:10:07.000Z">2020-03-25</time></p><p class="title is-6"><a class="link-muted" href="/xxe%E6%BC%8F%E6%B4%9E/">xxe漏洞</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-03-25T10:09:15.000Z">2020-03-25</time></p><p class="title is-6"><a class="link-muted" href="/%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E/">逻辑漏洞</a></p><p class="is-uppercase"></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2020/03/"><span class="level-start"><span class="level-item">三月 2020</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/02/"><span class="level-start"><span class="level-item">二月 2020</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="WebDog" height="28"></a><p class="size-small"><span>&copy; 2020 WebDog</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'http://yoursite.com',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>